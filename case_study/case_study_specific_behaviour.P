trigger_component_event_response(users_phone,locationEvent,Event_data):-
	write('users_phone reacting to location event'),nl,
	faltten_to_key_value_pairs(Event_data,[],Flat_kv_pairs),
	write(Flat_kv_pairs),nl,
	
	get_value_for_key(latitude,Flat_kv_pairs,Latitude_value),
	get_value_for_key(longitude,Flat_kv_pairs,Longitude_value),	
	write('Latitude - '),write(Latitude_value),nl,
	write('Longitude - '),write(Longitude_value),nl,
	
	distance(Latitude_value,Longitude_value,5,5,Distance),
	write('Distance calculated - '),write(Distance),nl,
	change_context_variable_value(distanceToWorkContextElement,Distance).
	
trigger_component_event_response(users_phone,incomingCallEvent,Event_data):-
	write('users_phone reacting to incoming call event'),nl.
	
trigger_component_event_response(calendar_application,meetingStartedEvent,Event_data):-
	write('calendar_application reacting to meeting started event'),nl,
	change_context_variable_value(meetingInProgressContextElement,true).
	
trigger_component_event_response(Component_name,Event_id,Event_data).

change_context_variable_value(Context_variable_name,Context_variable_new_value):-
	component_context_variable(Component_name,[Context_variable_name,Old_value]),
	
	retract(component_context_variable(Component_name,[Context_variable_name,_])),
	write('Setting new value '),write(Context_variable_new_value),write(' for context variable '),write(Context_variable_name),nl,
	assert(component_context_variable(Component_name,[Context_variable_name,Context_variable_new_value])).

distance(X1,Y1,X2,Y2,D):- 
    D is sqrt((X2-X1)**2 + (Y2-Y1)**2).

